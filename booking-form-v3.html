<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Form Pengajuan v3 - Dream Booking System</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); 
            padding: 20px; 
            line-height: 1.6;
            min-height: 100vh;
        }
        .container { 
            max-width: 600px; 
            margin: 0 auto; 
            background: white; 
            padding: 30px; 
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            position: relative;
        }
        .container::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 5px;
            background: linear-gradient(90deg, #27ae60, #3498db, #9b59b6);
            border-radius: 15px 15px 0 0;
        }
        .header {
            text-align: center;
            margin-bottom: 25px;
            padding-bottom: 20px;
            border-bottom: 2px solid #1a73e8;
        }
        .bismillah {
            color: #1a73e8;
            font-size: 20px;
            margin-bottom: 8px;
            font-weight: 600;
        }
        .school-name {
            color: #d23c3c;
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 5px;
        }
        .form-title {
            color: #2c3e50;
            font-size: 18px;
            margin-top: 8px;
            font-weight: 600;
        }
        .form-group {
            margin-bottom: 20px;
        }
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #2c3e50;
            font-size: 14px;
        }
        input, select, textarea {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 14px;
            transition: all 0.3s ease;
            background: #f8f9fa;
        }
        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #3498db;
            background: white;
            box-shadow: 0 0 0 4px rgba(52, 152, 219, 0.1);
            transform: translateY(-2px);
        }
        .checkbox-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            margin-top: 12px;
        }
        .checkbox-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 8px;
            border-radius: 6px;
            transition: background 0.3s ease;
        }
        .checkbox-item:hover {
            background: #f8f9fa;
        }
        .equipment-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 12px;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        .equipment-table th,
        .equipment-table td {
            border: 1px solid #e0e0e0;
            padding: 10px;
            text-align: left;
        }
        .equipment-table th {
            background: #3498db;
            color: white;
            font-weight: 600;
        }
        .equipment-table tr:nth-child(even) {
            background: #f8f9fa;
        }
        .btn {
            background: linear-gradient(135deg, #27ae60 0%, #2ecc71 100%);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            width: 100%;
            margin-top: 20px;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(39, 174, 96, 0.3);
        }
        .btn:active {
            transform: translateY(-1px);
        }
        .signature-section {
            margin-top: 30px;
            padding-top: 25px;
            border-top: 2px solid #e0e0e0;
        }
        .signature-line {
            display: flex;
            justify-content: space-between;
            margin-bottom: 25px;
            gap: 15px;
        }
        .signature-box {
            text-align: center;
            width: 32%;
            padding: 15px;
            border-radius: 10px;
            background: #f8f9fa;
            border: 2px solid #e0e0e0;
            transition: all 0.3s ease;
        }
        .signature-box:hover {
            border-color: #3498db;
            transform: translateY(-2px);
        }
        
        /* Enhanced Signature Styles */
        .signature-digital {
            margin-top: 12px;
            border: 2px dashed #ddd;
            padding: 12px;
            border-radius: 8px;
            background: white;
        }
        
        .signature-canvas {
            width: 100%;
            height: 120px;
            border: 2px solid #bdc3c7;
            border-radius: 6px;
            background: white;
            margin-bottom: 12px;
            cursor: crosshair;
        }
        
        .signature-actions {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .btn-clear {
            background: #e74c3c;
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 12px;
            font-weight: 600;
            transition: all 0.3s ease;
        }
        
        .btn-clear:hover {
            background: #c0392b;
            transform: translateY(-1px);
        }
        
        .signature-validation {
            font-size: 11px;
            margin-top: 8px;
            display: none;
            font-weight: 600;
        }
        
        .copyright {
            text-align: center;
            margin-top: 25px;
            color: #7f8c8d;
            font-size: 12px;
            padding-top: 20px;
            border-top: 1px solid #e0e0e0;
        }
        
        /* Enhanced Info Boxes */
        .info-box {
            background: linear-gradient(135deg, #e8f4fd, #d1ecf1);
            border-left: 5px solid #3498db;
            padding: 15px;
            margin: 15px 0;
            border-radius: 8px;
            font-size: 13px;
            box-shadow: 0 3px 10px rgba(52, 152, 219, 0.1);
        }
        
        .warning {
            background: linear-gradient(135deg, #ffeaa7, #fdcb6e);
            border-left: 5px solid #f39c12;
            padding: 15px;
            margin: 15px 0;
            border-radius: 8px;
            font-size: 13px;
            box-shadow: 0 3px 10px rgba(243, 156, 18, 0.1);
        }
        
        .facility-info {
            background: #d4edda;
            border-left: 4px solid #28a745;
            padding: 8px 10px;
            margin: 5px 0;
            border-radius: 5px;
            font-size: 11px;
            font-weight: 500;
        }
        
        .friday-alert {
            background: linear-gradient(135deg, #ff6b6b, #ee5a52);
            color: white;
            border-left: 5px solid #d63031;
            padding: 12px 15px;
            margin: 10px 0;
            border-radius: 6px;
            font-size: 12px;
            display: none;
            box-shadow: 0 3px 10px rgba(255, 107, 107, 0.2);
        }
        
        .wa-validation {
            font-size: 12px;
            margin-top: 6px;
            display: none;
            font-weight: 600;
        }
        
        .valid { color: #27ae60; }
        .invalid { color: #e74c3c; }
        
        /* Loading States */
        .btn-loading {
            background: linear-gradient(135deg, #95a5a6, #7f8c8d);
            cursor: not-allowed;
        }
        
        .loading-spinner {
            display: none;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,0.3);
            border-radius: 50%;
            border-top: 3px solid white;
            animation: spin 1s linear infinite;
            margin: 0 auto;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* Success Message */
        .success-message {
            display: none;
            background: linear-gradient(135deg, #27ae60, #2ecc71);
            color: white;
            padding: 25px;
            border-radius: 10px;
            text-align: center;
            margin-top: 20px;
            animation: slideDown 0.5s ease;
            box-shadow: 0 5px 15px rgba(39, 174, 96, 0.3);
        }
        
        @keyframes slideDown {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* Responsive Design */
        @media (max-width: 768px) {
            .container {
                padding: 20px 15px;
                margin: 10px;
            }
            
            .checkbox-grid {
                grid-template-columns: 1fr;
            }
            
            .signature-line {
                flex-direction: column;
            }
            
            .signature-box {
                width: 100%;
                margin-bottom: 15px;
            }
            
            .equipment-table {
                font-size: 12px;
            }
            
            .equipment-table th,
            .equipment-table td {
                padding: 8px 6px;
            }
        }
        
        /* Real-time Validation States */
        input.valid { border-color: #27ae60; }
        input.invalid { border-color: #e74c3c; }
        
        select.valid { border-color: #27ae60; }
        select.invalid { border-color: #e74c3c; }
        
        /* Equipment Custom Input */
        .equipment-custom {
            transition: all 0.3s ease;
        }
        
        .equipment-custom:focus {
            transform: translateY(-1px);
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="bismillah">ùìëùì≤ùìºùì∂ùì≤ùìµùìµùì™ùì± ùìëùì≤ ùìòùì≥ùì∑ùì≤ùìµùìµùì™ùì±</div>
            <div class="school-name">AL FIKRI</div>
            <div class="form-title">FORM PENGAJUAN TEMPAT DAN PERLENGKAPAN BARANG v3</div>
            <div style="color: #7f8c8d; font-size: 14px; margin-top: 5px;">Enhanced Version dengan Fitur Lengkap</div>
        </div>

        <div class="info-box">
            <strong>üìã INFORMASI BOOKING ENHANCED:</strong><br>
            ‚Ä¢ Jam operasional: <strong>07.30 - 16.00 WIB</strong><br>
            ‚Ä¢ Hari aktif: <strong>Senin - Jumat</strong> (Sabtu conditional, Minggu libur)<br>
            ‚Ä¢ <strong>JUMAT KHUSUS:</strong> Aula SMP & Serbaguna <strong>tidak available 10.30-13.00 WIB</strong><br>
            ‚Ä¢ Sistem anti double booking aktif dengan konfirmasi real-time
        </div>

        <form id="bookingForm">
            <div class="form-group">
                <label for="kegiatan">üìù Kegiatan / Acara:</label>
                <input type="text" id="kegiatan" name="kegiatan" required 
                       placeholder="Contoh: Coat King, P. BL Level 6, Latihan Assembly">
            </div>

            <div class="form-group">
                <label for="contact_wa">üì± Nomor WhatsApp:</label>
                <input type="tel" id="contact_wa" name="contact_wa" required 
                       placeholder="Contoh: 081234567890">
                <div id="waValidation" class="wa-validation"></div>
                <small style="color: #666;">Untuk konfirmasi booking dan notifikasi</small>
            </div>

            <div class="form-group">
                <label for="hari">üìÖ Hari:</label>
                <select id="hari" name="hari" required onchange="checkFridayRestrictions()">
                    <option value="">Pilih Hari</option>
                    <option value="Senin">Senin</option>
                    <option value="Selasa">Selasa</option>
                    <option value="Rabu">Rabu</option>
                    <option value="Kamis">Kamis</option>
                    <option value="Jumat">Jumat</option>
                    <option value="Sabtu">Sabtu (Conditional)</option>
                </select>
            </div>

            <div class="form-group">
                <label for="tanggal">üìÖ Tanggal:</label>
                <input type="date" id="tanggal" name="tanggal" required>
            </div>

            <div class="form-group">
                <label for="waktu_mulai">‚è∞ Waktu Mulai:</label>
                <select id="waktu_mulai" name="waktu_mulai" required onchange="checkFridayRestrictions(); validateTime();">
                    <option value="">Pilih Waktu Mulai</option>
                    <option value="07:30">07:30</option>
                    <option value="08:00">08:00</option>
                    <option value="08:30">08:30</option>
                    <option value="09:00">09:00</option>
                    <option value="09:30">09:30</option>
                    <option value="10:00">10:00</option>
                    <option value="10:30">10:30</option>
                    <option value="11:00">11:00</option>
                    <option value="11:30">11:30</option>
                    <option value="12:00">12:00</option>
                    <option value="12:30">12:30</option>
                    <option value="13:00">13:00</option>
                    <option value="13:30">13:30</option>
                    <option value="14:00">14:00</option>
                    <option value="14:30">14:30</option>
                    <option value="15:00">15:00</option>
                </select>
                <div id="timeStartValidation" class="wa-validation"></div>
            </div>

            <div class="form-group">
                <label for="waktu_selesai">‚è±Ô∏è Waktu Selesai:</label>
                <select id="waktu_selesai" name="waktu_selesai" required onchange="checkFridayRestrictions(); validateTime();">
                    <option value="">Pilih Waktu Selesai</option>
                    <option value="08:00">08:00</option>
                    <option value="08:30">08:30</option>
                    <option value="09:00">09:00</option>
                    <option value="09:30">09:30</option>
                    <option value="10:00">10:00</option>
                    <option value="10:30">10:30</option>
                    <option value="11:00">11:00</option>
                    <option value="11:30">11:30</option>
                    <option value="12:00">12:00</option>
                    <option value="12:30">12:30</option>
                    <option value="13:00">13:00</option>
                    <option value="13:30">13:30</option>
                    <option value="14:00">14:00</option>
                    <option value="14:30">14:30</option>
                    <option value="15:00">15:00</option>
                    <option value="15:30">15:30</option>
                    <option value="16:00">16:00</option>
                </select>
                <div id="timeEndValidation" class="wa-validation"></div>
            </div>

            <div class="form-group">
                <label>üèõÔ∏è Lokasi: (Silahkan checklist atau isi sesuai kebutuhan)</label>
                <div class="warning">
                    <strong>‚ö†Ô∏è PERHATIAN ENHANCED:</strong> Sistem anti double booking aktif dengan validasi real-time. 
                    Status availability akan ditampilkan secara otomatis.
                </div>
                <div id="fridayAlert" class="friday-alert">
                    <strong>üïå INFORMASI JUMAT:</strong> Aula SMP & Serbaguna tidak tersedia jam 10.30-13.00 WIB untuk persiapan shalat Jumat
                </div>
                <div class="checkbox-grid" id="lokasiContainer">
                    <!-- Lokasi akan di-generate oleh JavaScript -->
                </div>
                <input type="text" id="lokasi_lain" placeholder="Lain-lain (tulis disini)" style="margin-top: 12px;">
            </div>

            <div class="form-group">
                <label>üõ†Ô∏è Perlengkapan Barang: (silahkan pilih dari dropdown atau ketik manual)</label>
                <table class="equipment-table">
                    <thead>
                        <tr>
                            <th>No</th>
                            <th>Nama Barang</th>
                            <th>Jumlah</th>
                            <th>Keterangan</th>
                        </tr>
                    </thead>
                    <tbody id="equipmentBody">
                        <!-- Equipment rows will be generated by JavaScript -->
                    </tbody>
                </table>
                <button type="button" onclick="addEquipmentRow()" 
                        style="margin-top: 12px; padding: 8px 15px; background: #3498db; color: white; border: none; border-radius: 6px; cursor: pointer; font-weight: 600;">
                    ‚ûï Tambah Barang
                </button>
            </div>

            <div class="form-group">
                <label for="catatan">üí¨ Catatan Tambahan:</label>
                <textarea id="catatan" name="catatan" rows="3" 
                          placeholder="Catatan khusus untuk admin, informasi tambahan, atau permintaan khusus..."></textarea>
            </div>

            <!-- ‚úÖ ENHANCED TANDA TANGAN DIGITAL -->
            <div class="signature-section">
                <div class="info-box">
                    <strong>‚úçÔ∏è TANDA TANGAN DIGITAL WAJIB:</strong><br>
                    ‚Ä¢ Gunakan mouse/touch untuk tanda tangan di area yang disediakan<br>
                    ‚Ä¢ Pastikan tanda tangan jelas dan terbaca<br>
                    ‚Ä¢ Tanda tangan akan disimpan secara digital dan tidak dapat diubah
                </div>
                
                <div class="signature-line">
                    <!-- MENGETAHUI -->
                    <div class="signature-box">
                        <div style="font-weight: 600; margin-bottom: 8px;">Mengetahui</div>
                        <div style="color: #7f8c8d; font-size: 12px; margin-bottom: 10px;">Kepala Sekolah SIF Al Fikri</div>
                        
                        <div class="signature-digital">
                            <canvas class="signature-canvas" id="kepsekSignature"></canvas>
                            <div class="signature-actions">
                                <button type="button" class="btn-clear" onclick="clearSignature('kepsek')">
                                    üßπ Hapus
                                </button>
                                <div style="font-size: 10px; color: #7f8c8d;">Gunakan mouse/touch</div>
                            </div>
                            <div id="kepsekValidation" class="signature-validation invalid">
                                ‚ùå Tanda tangan wajib
                            </div>
                        </div>
                    </div>
                    
                    <!-- DISETUJUI -->
                    <div class="signature-box">
                        <div style="font-weight: 600; margin-bottom: 8px;">Disetujui</div>
                        <div style="color: #7f8c8d; font-size: 12px; margin-bottom: 10px;">Kepala Bidang Umum SIF Al Fikri</div>
                        
                        <div class="signature-digital">
                            <canvas class="signature-canvas" id="kabidSignature"></canvas>
                            <div class="signature-actions">
                                <button type="button" class="btn-clear" onclick="clearSignature('kabid')">
                                    üßπ Hapus
                                </button>
                                <div style="font-size: 10px; color: #7f8c8d;">Gunakan mouse/touch</div>
                            </div>
                            <div id="kabidValidation" class="signature-validation invalid">
                                ‚ùå Tanda tangan wajib
                            </div>
                        </div>
                    </div>
                    
                    <!-- PENANGGUNG JAWAB -->
                    <div class="signature-box">
                        <div style="font-weight: 600; margin-bottom: 8px;">Penanggung Jawab</div>
                        <div style="color: #7f8c8d; font-size: 12px; margin-bottom: 10px;">Guru/Karyawan</div>
                        
                        <div class="signature-digital">
                            <canvas class="signature-canvas" id="penanggungJawabSignature"></canvas>
                            <div class="signature-actions">
                                <button type="button" class="btn-clear" onclick="clearSignature('penanggungJawab')">
                                    üßπ Hapus
                                </button>
                                <div style="font-size: 10px; color: #7f8c8d;">Gunakan mouse/touch</div>
                            </div>
                            <div id="penanggungJawabValidation" class="signature-validation invalid">
                                ‚ùå Tanda tangan wajib
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <button type="submit" class="btn" id="submitBtn">
                <span id="btnText">üöÄ AJUKAN PERMOHONAN</span>
                <div class="loading-spinner" id="loadingSpinner"></div>
            </button>

            <div class="success-message" id="successMessage">
                <h3 style="margin-bottom: 10px;">üéâ FORM BERHASIL DIKIRIM!</h3>
                <p>Permohonan booking Anda sedang diproses dengan tanda tangan digital</p>
                <p style="margin-top: 10px; font-size: 14px;">Redirect ke halaman utama dalam <span id="countdown">3</span> detik...</p>
            </div>
        </form>

        <div class="copyright">
            Hanung Budianto, S.E.<br>
            <span id="currentDate"></span><br>
            copyright ¬© 2024 umum@alfikri.sch.id<br>
            <small style="color: #95a5a6;">Enhanced Version v3.0</small>
        </div>
    </div>

    <script>
        // Data sarana dengan informasi perlengkapan included
        const facilities = [
            { id: 'aula_smp', name: 'Aula SMP', equipment: 'Include: Sound System lengkap, Projector' },
            { id: 'aula_sma', name: 'Aula SMA', equipment: 'Include: Sound System lengkap, Projector' },
            { id: 'saung_besar', name: 'Saung Besar', equipment: 'Include: Sound System' },
            { id: 'saung_kecil', name: 'Saung Kecil', equipment: '' },
            { id: 'basket', name: 'Lapangan Basket', equipment: '' },
            { id: 'futsal', name: 'Lapangan Futsal Tanah', equipment: '' },
            { id: 'volley', name: 'Lapangan Volley', equipment: '' },
            { id: 'kantin', name: 'Kantin SMP', equipment: '' },
            { id: 'serbaguna', name: 'Ruang Serbaguna', equipment: 'Include: Sound System' },
            { id: 'playground', name: 'Playground', equipment: '' },
            { id: 'taman', name: 'Taman Depan Mesjid', equipment: '' },
            { id: 'mesjid', name: 'Mesjid', equipment: '' },
            { id: 'perpustakaan_sd', name: 'Perpustakaan SD', equipment: '' },
            { id: 'perpustakaan_smp', name: 'Perpustakaan SMP', equipment: '' },
            { id: 'perpustakaan_sma', name: 'Perpustakaan SMA', equipment: '' },
            { id: 'labkom_sd', name: 'Labkom SD', equipment: '' },
            { id: 'labkom_smp', name: 'Labkom SMP', equipment: '' },
            { id: 'labkom_sma', name: 'Labkom SMA', equipment: '' }
        ];

        const equipmentOptions = [
            "Speaker Portable Baretone",
            "Mic Hand Held (genggam)",
            "Mic Wireless", 
            "Projector",
            "Screen Projector",
            "Mimbar",
            "Meja Panjang",
            "Sound System Portable",
            "Kabel Roll",
            "Stand Mic",
            "Baterai Mic",
            "Laptop",
            "Kabel HDMI", 
            "Kabel VGA",
            "Adapter",
            "other"
        ];

        // ‚úÖ ENHANCED WA VALIDATION
        document.getElementById('contact_wa').addEventListener('input', function(e) {
            const value = e.target.value.replace(/\D/g, '');
            const validationDiv = document.getElementById('waValidation');
            
            if (value.length === 0) {
                validationDiv.style.display = 'none';
                this.classList.remove('valid', 'invalid');
            } else if (value.length >= 10 && value.length <= 13) {
                validationDiv.textContent = '‚úÖ Nomor WA valid';
                validationDiv.className = 'wa-validation valid';
                validationDiv.style.display = 'block';
                this.classList.add('valid');
                this.classList.remove('invalid');
            } else {
                validationDiv.textContent = '‚ùå Nomor WA harus 10-13 digit';
                validationDiv.className = 'wa-validation invalid';
                validationDiv.style.display = 'block';
                this.classList.add('invalid');
                this.classList.remove('valid');
            }
        });

        // ‚úÖ TIME VALIDATION
        function validateTime() {
            const start = document.getElementById('waktu_mulai').value;
            const end = document.getElementById('waktu_selesai').value;
            const startValidation = document.getElementById('timeStartValidation');
            const endValidation = document.getElementById('timeEndValidation');
            
            if (start && end) {
                if (start >= end) {
                    endValidation.textContent = '‚ùå Waktu selesai harus setelah waktu mulai';
                    endValidation.className = 'wa-validation invalid';
                    endValidation.style.display = 'block';
                    return false;
                } else {
                    endValidation.textContent = '‚úÖ Waktu valid';
                    endValidation.className = 'wa-validation valid';
                    endValidation.style.display = 'block';
                    return true;
                }
            }
            return true;
        }

        // Generate lokasi checklist dengan info perlengkapan
        function generateLocationChecklist() {
            const container = document.getElementById('lokasiContainer');
            facilities.forEach(facility => {
                const div = document.createElement('div');
                div.className = 'checkbox-item';
                div.innerHTML = `
                    <input type="checkbox" id="${facility.id}" name="lokasi" value="${facility.name}" 
                           onchange="checkFridayRestrictions(); checkAvailability(this)">
                    <label for="${facility.id}">${facility.name}</label>
                    ${facility.equipment ? `<div class="facility-info">${facility.equipment}</div>` : ''}
                `;
                container.appendChild(div);
            });
        }

        // Generate equipment table rows
        function generateEquipmentRows() {
            const tbody = document.getElementById('equipmentBody');
            for (let i = 1; i <= 3; i++) {
                const row = document.createElement('tr');
                row.innerHTML = createEquipmentRow(i);
                tbody.appendChild(row);
            }
        }

        function createEquipmentRow(rowNumber) {
            return `
                <td>${rowNumber}</td>
                <td>
                    <select class="equipment-select" onchange="handleEquipmentSelect(this)">
                        <option value="">-- Pilih Perlengkapan --</option>
                        ${equipmentOptions.map(opt => 
                            opt === 'other' 
                                ? `<option value="other">Lainnya (ketik manual)</option>`
                                : `<option value="${opt}">${opt}</option>`
                        ).join('')}
                    </select>
                    <input type="text" class="equipment-custom" placeholder="Ketik nama barang" style="display: none; margin-top: 8px;">
                </td>
                <td><input type="number" class="equipment-qty" placeholder="0" min="0" style="width: 80px;"></td>
                <td><input type="text" class="equipment-desc" placeholder="Keterangan"></td>
            `;
        }

        // Cek dan tampilkan alert untuk hari Jumat
        function checkFridayRestrictions() {
            const hari = document.getElementById('hari').value;
            const waktuMulai = document.getElementById('waktu_mulai').value;
            const waktuSelesai = document.getElementById('waktu_selesai').value;
            const alertDiv = document.getElementById('fridayAlert');
            
            if (hari === 'Jumat') {
                alertDiv.style.display = 'block';
                
                const jumatStart = '10:30';
                const jumatEnd = '13:00';
                const conflict = waktuMulai && waktuSelesai && 
                               ((waktuMulai < jumatEnd && waktuSelesai > jumatStart));
                
                if (conflict) {
                    document.getElementById('aula_smp').disabled = true;
                    document.getElementById('serbaguna').disabled = true;
                    
                    if (document.getElementById('aula_smp').checked) {
                        document.getElementById('aula_smp').checked = false;
                    }
                    if (document.getElementById('serbaguna').checked) {
                        document.getElementById('serbaguna').checked = false;
                    }
                } else {
                    document.getElementById('aula_smp').disabled = false;
                    document.getElementById('serbaguna').disabled = false;
                }
            } else {
                alertDiv.style.display = 'none';
                document.getElementById('aula_smp').disabled = false;
                document.getElementById('serbaguna').disabled = false;
            }
        }

        // Validasi khusus hari Jumat untuk Aula SMP dan Serbaguna
        function validateFridayRestrictions() {
            const hari = document.getElementById('hari').value;
            const waktuMulai = document.getElementById('waktu_mulai').value;
            const waktuSelesai = document.getElementById('waktu_selesai').value;
            
            if (hari === 'Jumat') {
                const selectedLocations = Array.from(document.querySelectorAll('input[name="lokasi"]:checked'))
                    .map(cb => cb.value);
                
                const restrictedLocations = ['Aula SMP', 'Ruang Serbaguna'];
                const hasRestrictedLocation = selectedLocations.some(loc => 
                    restrictedLocations.includes(loc)
                );
                
                if (hasRestrictedLocation) {
                    const jumatStart = '10:30';
                    const jumatEnd = '13:00';
                    const conflict = (waktuMulai < jumatEnd && waktuSelesai > jumatStart);
                    
                    if (conflict) {
                        return false;
                    }
                }
            }
            return true;
        }

        // Handle equipment selection
        function handleEquipmentSelect(select) {
            const row = select.closest('td');
            const customInput = row.querySelector('.equipment-custom');
            
            if (select.value === 'other') {
                customInput.style.display = 'block';
                customInput.required = true;
            } else {
                customInput.style.display = 'none';
                customInput.required = false;
                customInput.value = '';
            }
        }

        // Add new equipment row
        function addEquipmentRow() {
            const tbody = document.getElementById('equipmentBody');
            const newRow = document.createElement('tr');
            const rowNumber = tbody.children.length + 1;
            
            newRow.innerHTML = createEquipmentRow(rowNumber);
            tbody.appendChild(newRow);
        }

        // Check availability (simulated)
        function checkAvailability(checkbox) {
            // Simulate availability check
            if (checkbox.checked) {
                const isAvailable = Math.random() > 0.3; // 70% available
                if (!isAvailable) {
                    setTimeout(() => {
                        if (checkbox.checked) {
                            alert(`‚ö†Ô∏è ${checkbox.value} mungkin sudah dibooking. Silakan cek availability.`);
                        }
                    }, 500);
                }
            }
        }

        // Validasi double booking
        function checkDoubleBooking() {
            const selectedLocations = Array.from(document.querySelectorAll('input[name="lokasi"]:checked'))
                .map(cb => cb.value);
            const tanggal = document.getElementById('tanggal').value;
            const waktuMulai = document.getElementById('waktu_mulai').value;
            const waktuSelesai = document.getElementById('waktu_selesai').value;

            if (!tanggal || !waktuMulai || !waktuSelesai || selectedLocations.length === 0) {
                return true;
            }

            const existingBookings = JSON.parse(localStorage.getItem('bookings') || '[]');
            
            const hasConflict = existingBookings.some(booking => {
                const hasLocationConflict = selectedLocations.some(loc => 
                    booking.lokasi.includes(loc)
                );
                
                return hasLocationConflict && 
                       booking.tanggal === tanggal &&
                       ((waktuMulai >= booking.waktuMulai && waktuMulai < booking.waktuSelesai) ||
                        (waktuSelesai > booking.waktuMulai && waktuSelesai <= booking.waktuSelesai) ||
                        (waktuMulai <= booking.waktuMulai && waktuSelesai >= booking.waktuSelesai));
            });

            return !hasConflict;
        }

        // ‚úÖ ENHANCED TANDA TANGAN DIGITAL
        const signatureContexts = {};
        
        function initializeSignature(canvasId) {
            const canvas = document.getElementById(canvasId);
            const ctx = canvas.getContext('2d');
            let isDrawing = false;
            let lastX = 0;
            let lastY = 0;
            
            // Set canvas size properly
            canvas.width = canvas.offsetWidth;
            canvas.height = canvas.offsetHeight;
            
            // Set initial style
            ctx.strokeStyle = '#2c3e50';
            ctx.lineWidth = 2;
            ctx.lineCap = 'round';
            ctx.lineJoin = 'round';
            
            // Clear canvas with white background
            ctx.fillStyle = 'white';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            function startDrawing(e) {
                isDrawing = true;
                [lastX, lastY] = getCoordinates(e);
            }
            
            function draw(e) {
                if (!isDrawing) return;
                
                e.preventDefault();
                const [x, y] = getCoordinates(e);
                
                ctx.beginPath();
                ctx.moveTo(lastX, lastY);
                ctx.lineTo(x, y);
                ctx.stroke();
                
                [lastX, lastY] = [x, y];
                validateSignature(canvasId);
            }
            
            function getCoordinates(e) {
                const rect = canvas.getBoundingClientRect();
                if (e.type.includes('touch')) {
                    return [
                        e.touches[0].clientX - rect.left,
                        e.touches[0].clientY - rect.top
                    ];
                } else {
                    return [
                        e.clientX - rect.left,
                        e.clientY - rect.top
                    ];
                }
            }
            
            function stopDrawing() {
                isDrawing = false;
                validateSignature(canvasId);
            }
            
            // Mouse events
            canvas.addEventListener('mousedown', startDrawing);
            canvas.addEventListener('mousemove', draw);
            canvas.addEventListener('mouseup', stopDrawing);
            canvas.addEventListener('mouseout', stopDrawing);
            
            // Touch events for mobile
            canvas.addEventListener('touchstart', startDrawing);
            canvas.addEventListener('touchmove', draw);
            canvas.addEventListener('touchend', stopDrawing);
            
            signatureContexts[canvasId] = ctx;
            return ctx;
        }
        
        // CLEAR SIGNATURE
        function clearSignature(type) {
            const canvasMap = {
                'kepsek': 'kepsekSignature',
                'kabid': 'kabidSignature', 
                'penanggungJawab': 'penanggungJawabSignature'
            };
            
            const canvasId = canvasMap[type];
            const canvas = document.getElementById(canvasId);
            const ctx = signatureContexts[canvasId];
            
            ctx.fillStyle = 'white';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            validateSignature(canvasId);
        }
        
        // VALIDATE SIGNATURE
        function validateSignature(canvasId) {
            const canvas = document.getElementById(canvasId);
            const ctx = signatureContexts[canvasId];
            const validationDiv = document.getElementById(canvasId.replace('Signature', 'Validation'));
            
            // Check if canvas has any drawn content
            const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
            const hasSignature = imageData.data.some(channel => channel !== 255);
            
            if (hasSignature) {
                validationDiv.textContent = '‚úÖ Tanda tangan valid';
                validationDiv.className = 'signature-validation valid';
                validationDiv.style.display = 'block';
            } else {
                validationDiv.textContent = '‚ùå Tanda tangan wajib';
                validationDiv.className = 'signature-validation invalid';
                validationDiv.style.display = 'block';
            }
            
            return hasSignature;
        }
        
        // CHECK ALL SIGNATURES
        function validateAllSignatures() {
            const signatures = ['kepsekSignature', 'kabidSignature', 'penanggungJawabSignature'];
            return signatures.every(sigId => validateSignature(sigId));
        }
        
        // GET SIGNATURE AS DATA URL
        function getSignatureData(canvasId) {
            const canvas = document.getElementById(canvasId);
            return canvas.toDataURL();
        }

        // Collect equipment data
        function collectEquipmentData() {
            const equipment = [];
            document.querySelectorAll('#equipmentBody tr').forEach(row => {
                const select = row.querySelector('.equipment-select');
                const customInput = row.querySelector('.equipment-custom');
                const qty = row.querySelector('.equipment-qty');
                const desc = row.querySelector('.equipment-desc');
                
                const itemName = select.value === 'other' ? customInput.value : select.value;
                if (itemName && qty.value > 0) {
                    equipment.push({
                        nama: itemName,
                        jumlah: parseInt(qty.value),
                        keterangan: desc.value
                    });
                }
            });
            return equipment;
        }

        // Update current date
        document.getElementById('currentDate').textContent = new Date().toLocaleDateString('id-ID', {
            day: 'numeric', month: 'long', year: 'numeric'
        });

        // Enhanced form submission
        document.getElementById('bookingForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const submitBtn = document.getElementById('submitBtn');
            const btnText = document.getElementById('btnText');
            const loadingSpinner = document.getElementById('loadingSpinner');
            const successMessage = document.getElementById('successMessage');

            // Show loading
            submitBtn.classList.add('btn-loading');
            btnText.textContent = 'Memproses...';
            loadingSpinner.style.display = 'block';

            // Validate all requirements
            if (!validateAllSignatures()) {
                alert('‚ùå Semua tanda tangan digital wajib diisi!');
                resetButtonState();
                return;
            }
            
            const contactWA = document.getElementById('contact_wa').value.replace(/\D/g, '');
            if (contactWA.length < 10 || contactWA.length > 13) {
                alert('‚ùå Nomor WhatsApp harus 10-13 digit!');
                resetButtonState();
                return;
            }

            if (!validateTime()) {
                alert('‚ùå Waktu selesai harus setelah waktu mulai!');
                resetButtonState();
                return;
            }

            if (!checkDoubleBooking()) {
                alert('‚ùå KONFLIK BOOKING! Sarana yang dipilih sudah dibooking pada jam tersebut.\nSilakan pilih jam atau sarana lain.');
                resetButtonState();
                return;
            }

            if (!validateFridayRestrictions()) {
                alert('‚ùå KONFLIK JUMAT! Aula SMP dan Serbaguna tidak tersedia jam 10.30-13.00 WIB untuk persiapan shalat Jumat.\nSilakan pilih jam lain atau sarana lain.');
                resetButtonState();
                return;
            }

            // Simulate processing delay
            await new Promise(resolve => setTimeout(resolve, 2000));

            // Save to localStorage
            const formData = {
                kegiatan: document.getElementById('kegiatan').value,
                contact_wa: document.getElementById('contact_wa').value,
                hari: document.getElementById('hari').value,
                tanggal: document.getElementById('tanggal').value,
                waktuMulai: document.getElementById('waktu_mulai').value,
                waktuSelesai: document.getElementById('waktu_selesai').value,
                lokasi: Array.from(document.querySelectorAll('input[name="lokasi"]:checked')).map(cb => cb.value),
                lokasiLain: document.getElementById('lokasi_lain').value,
                perlengkapan: collectEquipmentData(),
                catatan: document.getElementById('catatan').value,
                signatures: {
                    kepsek: getSignatureData('kepsekSignature'),
                    kabid: getSignatureData('kabidSignature'),
                    penanggungJawab: getSignatureData('penanggungJawabSignature')
                },
                status: 'pending',
                timestamp: new Date().toISOString(),
                version: 'v3.0'
            };

            const existingBookings = JSON.parse(localStorage.getItem('bookings') || '[]');
            existingBookings.push(formData);
            localStorage.setItem('bookings', JSON.stringify(existingBookings));

            // Show success message
            successMessage.style.display = 'block';
            
            // Countdown redirect
            let countdown = 3;
            const countdownElement = document.getElementById('countdown');
            const countdownInterval = setInterval(() => {
                countdown--;
                countdownElement.textContent = countdown;
                if (countdown <= 0) {
                    clearInterval(countdownInterval);
                    window.location.href = 'index.html';
                }
            }, 1000);

            function resetButtonState() {
                submitBtn.classList.remove('btn-loading');
                btnText.textContent = 'üöÄ AJUKAN PERMOHONAN';
                loadingSpinner.style.display = 'none';
            }
        });

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            generateLocationChecklist();
            generateEquipmentRows();
            
            // Initialize signatures
            initializeSignature('kepsekSignature');
            initializeSignature('kabidSignature');
            initializeSignature('penanggungJawabSignature');
            
            // Set min date to today
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('tanggal').min = today;
            
            // Set default time to reasonable values
            document.getElementById('waktu_mulai').value = '08:00';
            document.getElementById('waktu_selesai').value = '10:00';
        });
    </script>
</body>
</html>
